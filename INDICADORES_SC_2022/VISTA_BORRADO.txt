
  CREATE OR REPLACE FORCE VIEW "SIG"."VISTA_INDICADOR3_MAYRA" ("NUME_ORDEN", "CODI_ADUAN", "CODI_REGI", "CODI_TDESP", "T_DESPACHO", "ANO_PRESE", "CLIENTE_RAZON_SOCIAL", "FEC_USUA_CREA", "FECHA_DESPACHO", "HORARIO_DESPACHO", "MES_FECHA_DESPACHO", "FEC_RETIRO", "DOC_COMPLETA", "FECHA_DOC_COMPLETA", "MES_DOC_COMPLETA", "COD_TERMINAL", "NOMBRE_ALMACEN", "TIPO_DIRECCIONAMIENTO", "DIA_PROGRAMAC", "CANT_FERIADO", "FECHA_PROG_CORREGIDA", "HORA_PROGRA", "HORA_A", "HORA_A_MAS1", "SABADO_MAS_DE_LAS_12", "FECHA_DOC_CORREGIDA", "DIA_FECHA_DOC_COM", "MES_FECHA_DOC_COM", "MES_FINAL", "FECHA3_MAYOR", "FECHA3_DIAS", "FECHA3", "HORA_MIN_SEG", "VERIFICADOR3") AS 
  SELECT NUME_ORDEN,CODI_ADUAN,CODI_REGI,CODI_TDESP,NVL(T_DESPACHO,'SIN T_DESPACHO') AS T_DESPACHO,ANO_PRESE,CLIENTE_RAZON_SOCIAL,FEC_USUA_CREA,
TO_CHAR(FEC_DESPACHO,'DD/MM/YYYY') FECHA_DESPACHO,
HORARIO_DESPACHO,
TO_CHAR(FEC_DESPACHO,'MONTH') MES_FECHA_DESPACHO,
FEC_RETIRO,DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'DD/MM/YYYY HH24:MI:SS') FECHA_DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'MONTH') MES_DOC_COMPLETA,
COD_TERMINAL,NOMBRE_ALMACEN,TIPO_DIRECCIONAMIENTO,
DIA_PROGRAMACION AS DIA_PROGRAMAC,
CANT_FERIADO,
TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') FECHA_PROG_CORREGIDA,
RPAD(SUBSTR(HORARIO_DESPACHO,1,5),8,':00') HORA_PROGRA,
HORA_A,
TO_CHAR((TO_DATE(HORA_A,'HH24:MI:SS')+INTERVAL '2' HOUR),'HH24:MI:SS') HORA_A_MAS1,
CASE WHEN DIA_FECHA_COM = 'SÁBADO   ' AND TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') > '12:00:00'  THEN 'VERDADERO' ELSE 'FALSO' END SABADO_MAS_DE_LAS_12,
TO_CHAR(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA),'DD/MM/YYYY') FECHA_DOC_CORREGIDA,
DIA_FECHA_COM  DIA_FECHA_DOC_COM,
MES_FECHA_COM  MES_FECHA_DOC_COM,
CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN TO_CHAR(TRUNC(FEC_DOC_COMPLETA,'MM'),'DD/MM/YYYY') ELSE TO_CHAR(TRUNC(FEC_RETIRO,'MM'),'DD/MM/YYYY') END MES_FINAL,
CASE WHEN TRUNC(FECHA_DOC_CORREGIDA) > TRUNC(FECHA_PROG_CORREGIDA) THEN 'SI' ELSE 'NO' END FECHA3_MAYOR,
CASE WHEN TO_CHAR(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA),'DD/MM/YYYY') = TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') THEN 'SI' ELSE 'NO' END FECHA3_DIAS,
CASE WHEN (TO_DATE(TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS'), 'HH24:MI:SS') > TO_DATE(HORA_A, 'HH24:MI:SS')) THEN 'NO' ELSE 'SI' END FECHA3,
TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') HORA_MIN_SEG,
CASE WHEN CODI_ADUAN = '235'  THEN 'APLICA' ELSE 'NO APLICA' END VERIFICADOR3
FROM(SELECT O.NUME_ORDEN,O.CODI_ADUAN,O.CODI_REGI,O.CODI_TDESP,
    (SELECT DESCRIPCION  FROM TIPO_ANTICIPADO WHERE ADUANA = O.CODI_ADUAN  AND CODIGO = O.TIPO_DESPACHO) AS T_DESPACHO,
    O.ANO_PRESE,
    (SELECT RASON_SOCIAL FROM CLIENTES WHERE CODIGOANT = O.CODI_CLIE AND ROWNUM = 1) CLIENTE_RAZON_SOCIAL,
    A.FEC_USUA_CREA,A.FEC_DESPACHO,
    (SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG) HORARIO_DESPACHO,
    O.FEC_RETIRO,A.DOC_COMPLETA,
    A.FEC_DOC_COMPLETA,
    O.COD_TERMINAL,O.NOMBRE_ALMACEN,
    (SELECT TIPO_DIRECCIONAMIENTO FROM SOLICITUD_VB LEFT JOIN SOLICITUD_VB_ORDEN S ON (S.ANIO_SOLICITUD = SOLICITUD_VB.ANIO_SOLICITUD AND S.NRO_SOLICITUD = SOLICITUD_VB.NRO_SOLICITUD AND S.ORDEN_MADRE = 1) WHERE (SOLICITUD_VB.EMPRESA = '001') AND (S.ANO_PRESE = A.ANO_PRESE) AND (S.NUME_ORDEN = O.NUME_ORDEN) AND ROWNUM = 1) TIPO_DIRECCIONAMIENTO,
    CASE WHEN A.FEC_DOC_COMPLETA IS NOT NULL THEN  TO_CHAR(A.FEC_DESPACHO,'DAY') ELSE 'NO HAY FECHA DE PROGRAMACION' END DIA_PROGRAMACION,
    F_DIA_FERIADO(A.FEC_DESPACHO) CANT_FERIADO,
    TO_CHAR(A.FEC_DOC_COMPLETA,'DAY') DIA_FECHA_COM,
    TO_CHAR(A.FEC_DOC_COMPLETA,'MONTH') MES_FECHA_COM,
    F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA) FECHA_DOC_CORREGIDA,
    F_PROG_CORREGIDA(1,FEC_DESPACHO) FECHA_PROG_CORREGIDA,
    CASE WHEN (TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1) < 10 THEN LPAD(RPAD(TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1,7,':00:00'),8,'0')
         ELSE RPAD(TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1,8,':00:00')
    END HORA_A
    FROM ORDEN O 
    INNER JOIN PROG_DESPACHO_CAB A ON (O.EMPRESA = A.EMPRESA AND O.NUME_ORDEN = A.NUME_ORDEN AND O.CODI_REGI = A.CODI_REGI AND O.CODI_ADUAN = A.CODI_ADUAN AND O.ANO_PRESE = A.ANO_PRESE)
    WHERE TRUNC(O.FEC_RETIRO) BETWEEN TRUNC(TO_DATE('01/01/2022')) AND TRUNC(TO_DATE('31/12/2022')) AND O.ANO_PRESE = '2022')
ORDER BY NUME_ORDEN ASC;
