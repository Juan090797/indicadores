SELECT NUME_ORDEN,CODI_ADUAN,CODI_REGI,CODI_TDESP,NVL(T_DESPACHO,'SIN T_DESPACHO') AS T_DESPACHO,ANO_PRESE,CLIENTE_RAZON_SOCIAL,FEC_USUA_CREA,
--NVL(TO_CHAR(FEC_DESPACHO,'DD/MM/YYYY'),'NO HAY FECHA DE PROGRAMACION') FECHA_DESPACHO,
TO_CHAR(FEC_DESPACHO,'DD/MM/YYYY') FECHA_DESPACHO,
HORARIO_DESPACHO,
--NVL(TO_CHAR(FEC_DESPACHO,'MONTH'),'NO HAY FECHA DE PROGRAMACION') AS MES_FECHA_DESPACHO,
TO_CHAR(FEC_DESPACHO,'MONTH') MES_FECHA_DESPACHO,
FEC_RETIRO,DOC_COMPLETA,
--NVL(TO_CHAR(FEC_DOC_COMPLETA,'DD/MM/YYYY HH24:MI:SS'),'NO HAY FECHA DE DOCUMENTACION') AS FECHA_DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'DD/MM/YYYY HH24:MI:SS') FECHA_DOC_COMPLETA,
--NVL(TO_CHAR(FEC_DOC_COMPLETA,'MONTH'),'NO HAY FECHA DE DOCUMENTACION') AS MES_DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'MONTH') MES_DOC_COMPLETA,
COD_TERMINAL,NOMBRE_ALMACEN,TIPO_DIRECCIONAMIENTO,
DIA_PROGRAMACION AS DIA_PROGRAMAC,
CANT_FERIADO,
--CASE WHEN FEC_DESPACHO IS NOT NULL THEN TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') ELSE 'NO HAY FECHA DE PROGRAMACION' END FECHA_PROG_CORREGIDA,
TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') FECHA_PROG_CORREGIDA,
CASE WHEN DIA_FECHA_COM = 'SÁBADO   ' AND TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') > '12:00:00'  THEN 'VERDADERO' ELSE 'FALSO' END SABADO_MAS_DE_LAS_12,
--CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN TO_CHAR(F_PROG_CORREGIDA(2,FEC_DOC_COMPLETA),'DD/MM/YYYY') ELSE 'NO HAY FECHA DE DOCUMENTACION' END FECHA_DOC_CORREGIDA,
TO_CHAR(F_PROG_CORREGIDA(2,FEC_DOC_COMPLETA),'DD/MM/YYYY') FECHA_DOC_CORREGIDA,
--CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN DIA_FECHA_COM ELSE 'NO HAY FECHA DE DOCUMENTACION' END DIA_FECHA_DOC_COM,
DIA_FECHA_COM DIA_FECHA_DOC_COM,
--CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN MES_FECHA_COM ELSE 'NO HAY FECHA DE DOCUMENTACION' END MES_FECHA_DOC_COM,
MES_FECHA_COM MES_FECHA_DOC_COM,
CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN TO_CHAR(TRUNC(FEC_DOC_COMPLETA,'MM'),'DD/MM/YYYY') ELSE TO_CHAR(TRUNC(FEC_RETIRO,'MM'),'DD/MM/YYYY') END MES_FINAL,
CASE WHEN TRUNC(F_PROG_CORREGIDA(1,FEC_DESPACHO)) > TRUNC(F_PROG_CORREGIDA(2,FEC_DOC_COMPLETA)) THEN TRUNC(F_PROG_CORREGIDA(1,FEC_DESPACHO)) - TRUNC(F_PROG_CORREGIDA(2,FEC_DOC_COMPLETA)) ELSE 0 END DIFERENCIA_DIAS,
CASE WHEN (CODI_ADUAN = '118' AND NOMBRE_ALMACEN ='DP WORLD CALLAO S.R.L.') OR (CODI_ADUAN = '118' AND NOMBRE_ALMACEN ='APM TERMINALS CALLAO S.A.') OR CODI_ADUAN <> '118' THEN 'NO APLICA' ELSE 'APLICA' END VERIFICADOR2,
F_INDICADOR2_MAYRA_JM(FEC_DESPACHO,FEC_DOC_COMPLETA) AS INDICADOR2
FROM(SELECT O.NUME_ORDEN,O.CODI_ADUAN,O.CODI_REGI,O.CODI_TDESP,
    (SELECT DESCRIPCION  FROM TIPO_ANTICIPADO WHERE ADUANA = O.CODI_ADUAN  AND CODIGO = O.TIPO_DESPACHO) AS T_DESPACHO,
    O.ANO_PRESE,
    (SELECT RASON_SOCIAL FROM CLIENTES WHERE CODIGOANT = O.CODI_CLIE AND ROWNUM = 1) CLIENTE_RAZON_SOCIAL,
    A.FEC_USUA_CREA,A.FEC_DESPACHO,
    (SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.hor_prog) HORARIO_DESPACHO,
    O.FEC_RETIRO,A.DOC_COMPLETA,
    A.FEC_DOC_COMPLETA,
    O.COD_TERMINAL,O.NOMBRE_ALMACEN,
    (SELECT TIPO_DIRECCIONAMIENTO FROM SOLICITUD_VB LEFT JOIN SOLICITUD_VB_ORDEN S ON (S.ANIO_SOLICITUD = SOLICITUD_VB.ANIO_SOLICITUD AND S.NRO_SOLICITUD = SOLICITUD_VB.NRO_SOLICITUD AND S.ORDEN_MADRE = 1) WHERE (SOLICITUD_VB.EMPRESA = '001') AND (S.ANO_PRESE = A.ANO_PRESE) AND (S.NUME_ORDEN = O.NUME_ORDEN) AND ROWNUM = 1) TIPO_DIRECCIONAMIENTO,
    CASE WHEN A.FEC_DOC_COMPLETA IS NOT NULL THEN  TO_CHAR(A.FEC_DESPACHO,'DAY')
         ELSE 'NO HAY FECHA DE PROGRAMACION'
     END DIA_PROGRAMACION,
    F_DIA_FERIADO(A.FEC_DESPACHO) CANT_FERIADO,
    TO_CHAR(A.FEC_DOC_COMPLETA,'DAY') DIA_FECHA_COM,
    TO_CHAR(A.FEC_DOC_COMPLETA,'MONTH') MES_FECHA_COM
    FROM ORDEN O 
    INNER JOIN PROG_DESPACHO_CAB A ON (O.EMPRESA = A.EMPRESA AND O.NUME_ORDEN = A.NUME_ORDEN AND O.CODI_REGI = A.CODI_REGI AND O.CODI_ADUAN = A.CODI_ADUAN AND O.ANO_PRESE = A.ANO_PRESE)
    WHERE TRUNC(O.FEC_RETIRO) BETWEEN TRUNC(TO_DATE('01/01/2022')) AND TRUNC(TO_DATE('31/12/2022')) AND O.ANO_PRESE = '2022') 
--WHERE NUME_ORDEN = '006236'
ORDER BY NUME_ORDEN ASC;

---------------------INDICADOR2--------------------------------------------


SELECT NUME_ORDEN,CODI_ADUAN,CODI_REGI,CODI_TDESP,NVL(T_DESPACHO,'SIN T_DESPACHO') AS T_DESPACHO,ANO_PRESE,CLIENTE_RAZON_SOCIAL,FEC_USUA_CREA,
TO_CHAR(FEC_DESPACHO,'DD/MM/YYYY') FECHA_DESPACHO,
HORARIO_DESPACHO,
TO_CHAR(FEC_DESPACHO,'MONTH') MES_FECHA_DESPACHO,
FEC_RETIRO,DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'DD/MM/YYYY HH24:MI:SS') FECHA_DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'MONTH') MES_DOC_COMPLETA,
COD_TERMINAL,NOMBRE_ALMACEN,TIPO_DIRECCIONAMIENTO,
DIA_PROGRAMACION AS DIA_PROGRAMAC,
CANT_FERIADO,
TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY')FECHA_PROG_CORREGIDA,
CASE WHEN DIA_FECHA_COM = 'SÁBADO   ' AND TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') > '12:00:00'  THEN 'VERDADERO' ELSE 'FALSO' END SABADO_MAS_DE_LAS_12,
TO_CHAR(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA),'DD/MM/YYYY') FECHA_DOC_CORREGIDA,
DIA_FECHA_COM DIA_FECHA_DOC_COM,
MES_FECHA_COM  MES_FECHA_DOC_COM,
CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN TO_CHAR(TRUNC(FEC_DOC_COMPLETA,'MM'),'DD/MM/YYYY') ELSE TO_CHAR(TRUNC(FEC_RETIRO,'MM'),'DD/MM/YYYY') END MES_FINAL,
CASE WHEN TRUNC(F_PROG_CORREGIDA(1,FEC_DESPACHO)) > TRUNC(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA)) THEN TRUNC(F_PROG_CORREGIDA(1,FEC_DESPACHO)) - TRUNC(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA)) ELSE 0 END DIFERENCIA_DIAS,
CASE WHEN (CODI_ADUAN = '118' AND NOMBRE_ALMACEN ='DP WORLD CALLAO S.R.L.') OR (CODI_ADUAN = '118' AND NOMBRE_ALMACEN ='APM TERMINALS CALLAO S.A.') THEN 'APLICA' ELSE 'NO APLICA' END VERIFICADOR2,
F_INDICADOR1_MAYRA_JM(FEC_DESPACHO,FEC_DOC_COMPLETA) AS INDICADOR2
FROM(SELECT O.NUME_ORDEN,O.CODI_ADUAN,O.CODI_REGI,O.CODI_TDESP,
    (SELECT DESCRIPCION  FROM TIPO_ANTICIPADO WHERE ADUANA = O.CODI_ADUAN  AND CODIGO = O.TIPO_DESPACHO) AS T_DESPACHO,
    O.ANO_PRESE,
    (SELECT RASON_SOCIAL FROM CLIENTES WHERE CODIGOANT = O.CODI_CLIE AND ROWNUM = 1) CLIENTE_RAZON_SOCIAL,
    A.FEC_USUA_CREA,A.FEC_DESPACHO,
    (SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.hor_prog) HORARIO_DESPACHO,
    O.FEC_RETIRO,A.DOC_COMPLETA,
    A.FEC_DOC_COMPLETA,
    O.COD_TERMINAL,O.NOMBRE_ALMACEN,
    (SELECT TIPO_DIRECCIONAMIENTO FROM SOLICITUD_VB LEFT JOIN SOLICITUD_VB_ORDEN S ON (S.ANIO_SOLICITUD = SOLICITUD_VB.ANIO_SOLICITUD AND S.NRO_SOLICITUD = SOLICITUD_VB.NRO_SOLICITUD AND S.ORDEN_MADRE = 1) WHERE (SOLICITUD_VB.EMPRESA = '001') AND (S.ANO_PRESE = A.ANO_PRESE) AND (S.NUME_ORDEN = O.NUME_ORDEN) AND ROWNUM = 1) TIPO_DIRECCIONAMIENTO,
    CASE WHEN A.FEC_DOC_COMPLETA IS NOT NULL THEN  TO_CHAR(A.FEC_DESPACHO,'DAY') ELSE 'NO HAY FECHA DE PROGRAMACION' END DIA_PROGRAMACION,
    F_DIA_FERIADO(A.FEC_DESPACHO) CANT_FERIADO,
    TO_CHAR(A.FEC_DOC_COMPLETA,'DAY') DIA_FECHA_COM,
    TO_CHAR(A.FEC_DOC_COMPLETA,'MONTH') MES_FECHA_COM
    FROM ORDEN O 
    INNER JOIN PROG_DESPACHO_CAB A ON (O.EMPRESA = A.EMPRESA AND O.NUME_ORDEN = A.NUME_ORDEN AND O.CODI_REGI = A.CODI_REGI AND O.CODI_ADUAN = A.CODI_ADUAN AND O.ANO_PRESE = A.ANO_PRESE)
    WHERE TRUNC(O.FEC_RETIRO) BETWEEN TRUNC(TO_DATE('01/01/2022')) AND TRUNC(TO_DATE('31/12/2022')) AND O.ANO_PRESE = '2022')
ORDER BY NUME_ORDEN ASC;



-------------------------------------

SELECT TO_CHAR(TO_DATE('00:00:00','HH24:MI:SS') + (TO_DATE('19:25:00', 'HH24:MI:SS') - TO_DATE('18:00:00', 'HH24:MI:SS')), 'HH24:MI:SS') Diferencia FROM DUAL;

SELECT TO_CHAR(TO_DATE('19:25:00', 'HH24:MI:SS') - TO_DATE('18:00:00', 'HH24:MI:SS'), 'HH24:MI:SS') Diferencia FROM DUAL;

SELECT TO_CHAR( TO_DATE('19:25:00', 'HH24:MI:SS') + TO_DATE('01:00:00', 'HH24:MI:SS'), 'HH24:MI:SS') Diferencia FROM DUAL;

SELECT TO_CHAR((TO_DATE('01:43:00','HH24:MI:SS')+INTERVAL '15' HOUR),'HH24:MI:SS') SUMA FROM dual;

SELECT TO_INT(SYSDATE, 'MM/DD/YYYY HR:MN:SE') PRUEBA FROM DUAL;

SELECT TRUNC(TO_DATE('31/10/2007','DD/MM/YYYY'),'MM') FROM DUAL;

------------------INDICADOR3-------------------------------------


--CREATE OR REPLACE VIEW VISTA_INDICADOR3_MAYRA AS 
SELECT NUME_ORDEN,CODI_ADUAN,CODI_REGI,CODI_TDESP,NVL(T_DESPACHO,'SIN T_DESPACHO') AS T_DESPACHO,ANO_PRESE,CLIENTE_RAZON_SOCIAL,FEC_USUA_CREA,
TO_CHAR(FEC_DESPACHO,'DD/MM/YYYY') FECHA_DESPACHO,
HORARIO_DESPACHO,
TO_CHAR(FEC_DESPACHO,'MONTH') MES_FECHA_DESPACHO,
FEC_RETIRO,DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'DD/MM/YYYY HH24:MI:SS') FECHA_DOC_COMPLETA,
TO_CHAR(FEC_DOC_COMPLETA,'MONTH') MES_DOC_COMPLETA,
COD_TERMINAL,NOMBRE_ALMACEN,TIPO_DIRECCIONAMIENTO,
DIA_PROGRAMACION AS DIA_PROGRAMAC,CANT_FERIADO,
TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') FECHA_PROG_CORREGIDA,
RPAD(SUBSTR(HORARIO_DESPACHO,1,5),8,':00') HORA_PROGRA,
HORA_A,
TO_CHAR((TO_DATE(HORA_A,'HH24:MI:SS')+INTERVAL '2' HOUR),'HH24:MI:SS') HORA_A_MAS1,
CASE WHEN DIA_FECHA_COM = 'SÁBADO   ' AND TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') > '12:00:00'  THEN 'VERDADERO' ELSE 'FALSO' END SABADO_MAS_DE_LAS_12,
TO_CHAR(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA),'DD/MM/YYYY') FECHA_DOC_CORREGIDA,
DIA_FECHA_COM  DIA_FECHA_DOC_COM,
MES_FECHA_COM  MES_FECHA_DOC_COM,
CASE WHEN FEC_DOC_COMPLETA IS NOT NULL THEN TO_CHAR(TRUNC(FEC_DOC_COMPLETA,'MM'),'DD/MM/YYYY') ELSE TO_CHAR(TRUNC(FEC_RETIRO,'MM'),'DD/MM/YYYY') END MES_FINAL,
CASE WHEN TRUNC(FECHA_DOC_CORREGIDA) > TRUNC(FECHA_PROG_CORREGIDA) THEN 'SI' ELSE 'NO' END FECHA3_MAYOR,
CASE WHEN TO_CHAR(F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA),'DD/MM/YYYY') = TO_CHAR(F_PROG_CORREGIDA(1,FEC_DESPACHO),'DD/MM/YYYY') THEN 'SI' ELSE 'NO' END FECHA3_DIAS,
CASE WHEN (TO_DATE(TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS'), 'HH24:MI:SS') > TO_DATE(HORA_A, 'HH24:MI:SS')) THEN 'NO' ELSE 'SI' END FECHA3,
TO_CHAR(FEC_DOC_COMPLETA,'HH24:MI:SS') HORA_MIN_SEG,
CASE WHEN CODI_ADUAN = '235' THEN 'APLICA' ELSE 'NO APLICA' END VERIFICADOR3
FROM(SELECT O.NUME_ORDEN,O.CODI_ADUAN,O.CODI_REGI,O.CODI_TDESP,
    (SELECT DESCRIPCION  FROM TIPO_ANTICIPADO WHERE ADUANA = O.CODI_ADUAN  AND CODIGO = O.TIPO_DESPACHO) AS T_DESPACHO,
    O.ANO_PRESE,
    (SELECT RASON_SOCIAL FROM CLIENTES WHERE CODIGOANT = O.CODI_CLIE AND ROWNUM = 1) CLIENTE_RAZON_SOCIAL,
    A.FEC_USUA_CREA,A.FEC_DESPACHO,
    (SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG) HORARIO_DESPACHO,
    O.FEC_RETIRO,A.DOC_COMPLETA,
    A.FEC_DOC_COMPLETA,
    O.COD_TERMINAL,O.NOMBRE_ALMACEN,
    (SELECT TIPO_DIRECCIONAMIENTO FROM SOLICITUD_VB LEFT JOIN SOLICITUD_VB_ORDEN S ON (S.ANIO_SOLICITUD = SOLICITUD_VB.ANIO_SOLICITUD AND S.NRO_SOLICITUD = SOLICITUD_VB.NRO_SOLICITUD AND S.ORDEN_MADRE = 1) WHERE (SOLICITUD_VB.EMPRESA = '001') AND (S.ANO_PRESE = A.ANO_PRESE) AND (S.NUME_ORDEN = O.NUME_ORDEN) AND ROWNUM = 1) TIPO_DIRECCIONAMIENTO,
    CASE WHEN A.FEC_DOC_COMPLETA IS NOT NULL THEN  TO_CHAR(A.FEC_DESPACHO,'DAY') ELSE 'NO HAY FECHA DE PROGRAMACION' END DIA_PROGRAMACION,
    F_DIA_FERIADO(A.FEC_DESPACHO) CANT_FERIADO,
    TO_CHAR(A.FEC_DOC_COMPLETA,'DAY') DIA_FECHA_COM,
    TO_CHAR(A.FEC_DOC_COMPLETA,'MONTH') MES_FECHA_COM,
    F_PROG_CORREGIDA(3,FEC_DOC_COMPLETA) FECHA_DOC_CORREGIDA,
    F_PROG_CORREGIDA(1,FEC_DESPACHO) FECHA_PROG_CORREGIDA,
    CASE WHEN (TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1) < 10 THEN LPAD(RPAD(TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1,7,':00:00'),8,'0')
         ELSE RPAD(TO_NUMBER(SUBSTR((SELECT DES_HORARIO FROM HORARIO WHERE COD_HORARIO = A.HOR_PROG),1,2)) - 1,8,':00:00')
    END HORA_A
    FROM ORDEN O 
    INNER JOIN PROG_DESPACHO_CAB A ON (O.EMPRESA = A.EMPRESA AND O.NUME_ORDEN = A.NUME_ORDEN AND O.CODI_REGI = A.CODI_REGI AND O.CODI_ADUAN = A.CODI_ADUAN AND O.ANO_PRESE = A.ANO_PRESE)
    WHERE TRUNC(O.FEC_RETIRO) BETWEEN TRUNC(TO_DATE('01/01/2022')) AND TRUNC(TO_DATE('31/12/2022')) AND O.ANO_PRESE = '2022')
ORDER BY NUME_ORDEN ASC;

----------------------------

SELECT NUME_ORDEN,CODI_ADUAN,CODI_REGI,CODI_TDESP,T_DESPACHO,ANO_PRESE AS AÑO,CLIENTE_RAZON_SOCIAL,FEC_USUA_CREA,FECHA_DESPACHO,HORARIO_DESPACHO,MES_FECHA_DESPACHO,FEC_RETIRO,
DOC_COMPLETA,FECHA_DOC_COMPLETA,MES_DOC_COMPLETA,COD_TERMINAL,NOMBRE_ALMACEN,DIA_PROGRAMAC,FECHA_PROG_CORREGIDA,HORA_PROGRA,HORA_A,SABADO_MAS_DE_LAS_12,FECHA_DOC_CORREGIDA,
DIA_FECHA_DOC_COM,MES_FECHA_DOC_COM,MES_FINAL,FECHA3_MAYOR,FECHA3_DIAS AS FECHA3_DIAS_IGUALES,FECHA3 AS FECHA3_COMPARAR_HORAS,
F_OBTENER_FECHA3(HORA_MIN_SEG,HORA_PROGRA,FECHA_DOC_COMPLETA) FECHA_3,
HORA_MIN_SEG,VERIFICADOR3,
F_INDICADOR3_MAYRA(FECHA_DESPACHO,FECHA_DOC_COMPLETA,FECHA3_MAYOR,FECHA3_DIAS,FECHA3) INDICADOR3
FROM VISTA_INDICADOR3_MAYRA;

------------------------------------------------------------------------------------


SELECT 
        RUC_PROVEEDOR,RAZON_SOCIAL,TIPO_DOCUMENTO,NRO_DOC,FECHA_EMISION,FECHA_SUBIDA_FACTURA,TO_CHAR(FECHA_SUBIDA_FACTURA,'MONTH') MES,ORDEN_VINCULADA,FECHA_VINCULO_ORDEN,USUARIO_VINCULO_ORDEN,FORMA_SUBIDA_FACTURA,
        FEC_SUBIDA,FEC_VINCULACION,
        CASE WHEN (TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) > 0 THEN  (TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) 
        ELSE 0
        END DIAS_SIN_FDS,
        F_VALIDAR_REPORT(TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) FILTRO_SIN_FDS,
        CASE WHEN (F_DIAS_HABILES_JMV(FEC_SUBIDA,FEC_VINCULACION) - 1) > 0 THEN (F_DIAS_HABILES_JMV(FEC_SUBIDA,FEC_VINCULACION) - 1)
        ELSE 0
        END DIFERENCIA_DIAS_UTILES,
        F_VALIDAR_REPORT(F_DIAS_HABILES_JMV(FEC_SUBIDA,FEC_VINCULACION) - 1) INDICADOR_PRE,
        CASE WHEN F_VALIDAR_REPORT(TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) = F_VALIDAR_REPORT(F_DIAS_HABILES_JMV(FEC_SUBIDA,FEC_VINCULACION) - 1) THEN 'IGUAL'
             ELSE 'DIFERENTE'
        END VALIDACION,
        F_IND4_FACT_VINCU(FECHA_SUBIDA_FACTURA,FECHA_VINCULO_ORDEN,(F_DIAS_HABILES_JMV(FEC_SUBIDA,FEC_VINCULACION) - 1)) INDICADOR4
FROM(SELECT  RUC_PROVEEDOR,
        razon_social,
        ruc_adquirente,
        razon_social_adquirente,
        decode(TIPO_DOCUMENTO,'01','FACTURA','07','NOTA CREDITO','08','NOTA DEBITO','NO ESPECIFICADO')TIPO_DOCUMENTO,
        SERIE || '-'|| numero_documento nro_doc,
        fecha_emision,
        fecha_registro AS FECHA_SUBIDA_FACTURA,        
        nume_orden ORDEN_VINCULADA,
        f_cargar_orden AS FECHA_VINCULO_ORDEN,
        usuario_cargar_orden AS USUARIO_VINCULO_ORDEN,
        DECODE(version_ubl,'2.1','AUTOMATICO','MANUAL') FORMA_SUBIDA_FACTURA,
        CASE WHEN '18:00' > TO_CHAR(fecha_registro,'HH24:MI') THEN TRUNC(fecha_registro) ELSE (TRUNC(fecha_registro)+1) END FEC_SUBIDA,
        TRUNC(f_cargar_orden) FEC_VINCULACION
        FROM face_facturamz 
        WHERE FECHA_EMISION BETWEEN ('01/01/2022') AND ('31/12/2022') AND TIPO_DOCUMENTO = '01' AND RUC_PROVEEDOR NOT IN ('20100246768','20100457629') AND dar_baja_flag IS NULL AND nume_orden IS NOT NULL)
        --AND version_ubl = '2.1'
ORDER BY ORDEN_VINCULADA ASC



-------------------------------------------

SELECT 
        RUC_PROVEEDOR,RAZON_SOCIAL,TIPO_DOCUMENTO,NRO_DOC,TO_CHAR(FECHA_EMISION,'DD/MM/YYYY') FECHA_EMISION,FECHA_SUBIDA_FACTURA,TO_CHAR(FECHA_SUBIDA_FACTURA,'MONTH') MES,ORDEN_VINCULADA,FECHA_VINCULO_ORDEN,USUARIO_VINCULO_ORDEN,FORMA_SUBIDA_FACTURA,
        TO_CHAR(FEC_SUBIDA,'DD/MM/YYYY') FEC_SUBIDA,TO_CHAR(FEC_VINCULACION,'DD/MM/YYYY') FECHA_VINCULACION,
        CASE WHEN (TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) > 0 THEN  (TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA))+1
        ELSE 0
        END DIAS_SIN_FDS,
        F_VALIDAR_REPORT(TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) FILTRO_SIN_FDS,
        /*CASE WHEN (F_DIAS_HABILES_JMV(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1) > 0 THEN (F_DIAS_HABILES_JMV(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1)
        ELSE 0
        END DIFERENCIA_DIAS_UTILES,*/
        (F_DIAS_HABILES_I4(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1) DIF_DIAS_UTILES,
        F_VALIDAR_REPORT(F_DIAS_HABILES_I4(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1) INDICADOR_PRE,
        /*CASE WHEN F_VALIDAR_REPORT(TRUNC(FEC_VINCULACION) - TRUNC(FEC_SUBIDA)) = F_VALIDAR_REPORT(F_DIAS_HABILES_I4(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1) THEN 'IGUAL'
             ELSE 'DIFERENTE'
        END VALIDACION,*/
        F_IND4_FACT_VINCU(FECHA_SUBIDA_FACTURA,FECHA_VINCULO_ORDEN,(F_DIAS_HABILES_I4(FECHA_SUBIDA_FACTURA,FEC_VINCULACION) - 1)) INDICADOR4
FROM(SELECT  RUC_PROVEEDOR,
        razon_social,
        ruc_adquirente,
        razon_social_adquirente,
        DECODE(TIPO_DOCUMENTO,'01','FACTURA','07','NOTA CREDITO','08','NOTA DEBITO','NO ESPECIFICADO')TIPO_DOCUMENTO,
        SERIE || '-'|| numero_documento nro_doc,
        FECHA_EMISION,
        fecha_registro AS FECHA_SUBIDA_FACTURA,        
        NUME_ORDEN ORDEN_VINCULADA,
        f_cargar_orden AS FECHA_VINCULO_ORDEN,
        usuario_cargar_orden AS USUARIO_VINCULO_ORDEN,
        DECODE(version_ubl,'2.1','AUTOMATICO','MANUAL') FORMA_SUBIDA_FACTURA,
        CASE WHEN '18:00' > TO_CHAR(fecha_registro,'HH24:MI') THEN TRUNC(fecha_registro) ELSE (TRUNC(fecha_registro)+1) END FEC_SUBIDA,
        TRUNC(f_cargar_orden) FEC_VINCULACION
        FROM face_facturamz 
        WHERE FECHA_EMISION BETWEEN ('01/01/2022') AND ('31/12/2022') AND TIPO_DOCUMENTO = '01' AND RUC_PROVEEDOR NOT IN ('20100246768','20100457629') AND DAR_BAJA_FLAG IS NULL AND NUME_ORDEN IS NOT NULL)
        --AND version_ubl = '2.1'
WHERE NRO_DOC = 'E001-1071'
ORDER BY ORDEN_VINCULADA ASC